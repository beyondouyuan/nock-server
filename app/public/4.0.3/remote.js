(() => {var proxyManage={};proxyManage.global=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),proxyManage.container=global;const openApi="https://api.anythinktech.com",tkApi="https://tk.anythinktech.com";var globalContext=Object.getPrototypeOf(proxyManage.global)||proxyManage.global,globalContainer=proxyManage.container;function getRequire(){return globalContext&&globalContext.$topon_sdk?globalContext.$topon_sdk.api:null}function queryString(e,t){var o,n=[];for(o in t)n.push(o+"="+t[o]);var r=n.join("&");return r?e+"?"+r:e}function isJsonString(e){if("string"==typeof e)try{var t=JSON.parse(e);return!("object"!=typeof t||!t)}catch(e){return!1}}function deCamelize(e,t={}){var o=t.separator||"-",t=t.split||/(?=[A-Z])/;return e.split(t).join(o).toLowerCase()}function camelize(e,t={}){t=t.separator||/_(\w)/g;return e.toLowerCase().replace(t,(e,t)=>t.toUpperCase())}function random(e,t){return Math.floor(Math.random()*(t-e))+e}function getSign(e,t){var o=t.length,n=[];for(let e=0;e<o;e++){var r=t[e].key,a=t[e].value;n.push(r+"="+a)}e+=n.join("&");return getRequire().md5(e).toString()}function getEncryptData(e){return Base64.btoa(e)}function getStringifyData(e){return JSON.stringify(e).replace(/\//g,"\\/")}async function getUpid(){var e="TOP_ON_UP_ID";let a="";var i=getRequire().device,s=getRequire().md5,l=getRequire().storage,t=(console.log("getUpid 1"),await l.get({key:e}));if(a=t.data,console.log("getUpid 2"),!a){let t,o,n,r;await Promise.all([i.getAdvertisingId(),i.getDeviceId(),i.getOAID(),i.getUserId()]).then(e=>{t=e[0].data.advertisingId,o=e[1].data.deviceId,n=e[2].data.oaid,r=e[3].data.userId}),a=t?s(t):o?s(o):n?s(n):r?s(r):s(await l.get({key:"appId"})+Date.now()+random(0,1e8)),await l.set({key:e,value:a})}return a}async function getRequestId(){var e=(new Date).getTime(),t=await getRequire().device.getId({type:["device","mac","user","advertising"]}),o=(console.log("getRequestId 1"),await getUpid()),n=[t.user,t.advertising,o,e],t=(console.log("getRequestId 2"),random(0,1e4)),r=n.length,a=[];for(let e=0;e<r;e++)a.push(n[e]);a.push(t);o=a.join("&");return getRequire().md5(o).toString()}function sourceToParams(o,n){const r={};return Object.keys(n).forEach(e=>{var t=n[e];r[t]=""+o[e]}),r}function getUserAgent(){return globalContainer.navigator.userAgent||""}var components={placement:{adProxyEvent:{onInit:function(){console.log("placement onInit")}}},native:{adProxyEvent:{onInit:async function(){console.log("native onInit"),this.onProxyAdLoad("remote 调用")}},onProxyAdLoad:async function(e){console.log("onProxyAdLoad",e),console.log(getRequire()),this.sendReport()},sendReport:async function(){console.log("async function");var e=await this.$app.$def.topon_sdk.service.sendReport();console.log("await result",e),console.log("wow")}},rewardedVideo:{adProxyEvent:{}},splash:{adProxyEvent:{}}};const TIMEOUT=2e4;function fetchPromise(e){return new Promise((t,o)=>{getRequire().$fetch.fetch({url:e.url,method:e.method,header:{"Content-Type":"application/json;charset=utf-8"},data:e.data}).then(e=>{e=e.data,e=isJsonString(null==e?void 0:e.data)?JSON.parse(null==e?void 0:e.data):e.data;t(e)}).catch((e,t)=>{console.log("🐛 request fail, code = "+t),o(e)}).finally(()=>{console.log(`✔️ request @${e.url} has been completed.`),t()})})}function requestHandle(e,o=TIMEOUT){try{return Promise.race([fetchPromise(e),new Promise((e,t)=>{setTimeout(()=>{t(new Error("网络状况不太好，再刷新一次？"))},o)})])}catch(e){console.log(e)}}Promise.prototype.finally=function(t){const o=this.constructor;return this.then(e=>o.resolve(t()).then(()=>e),e=>o.resolve(t()).then(()=>{throw e}))};var $requestService={post:function(e,t){return requestHandle({method:"post",url:e,data:t})},get:function(e,t){return requestHandle({method:"get",url:queryString(e,t)})},put:function(e,t){return requestHandle({method:"put",url:e,data:t})}};function preProgram(e,t){return function(e,t){e&&e.$def&&!e.$def.topon_sdk&&(e.$def.topon_sdk=Object.create(null),(e.$def.topon_sdk.$app=e).$def.topon_sdk.components=components,e.$def.topon_sdk.appId=t.appId,e.$def.topon_sdk.service={getPlacement:getPlacement,sendReport:sendReport},e.$def.topon_sdk.appKey=t.appKey)}.call(global,e,t)}async function sendReport(e){try{console.log("执行顺序 1",1);getUserAgent();console.log("执行顺序 2",2);var o=await getRequestId();return console.log("执行顺序 final","final"),new Promise((e,t)=>{e(o)})}catch(e){console.log("error",e)}}function getPlacement(e){return $requestService.post(openApi+"/v2/open/placement",e)}globalContext&&(globalContext.$topon_sdk=preProgram);})();